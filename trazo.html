<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Pauta Lamela ‚Äî pr√°ctica de trazos</title>
<style>
  :root{
    --ink:#111; --panel:#fff; --border:#d1d5db; --bg:#f3f4f6;
    --sec:#3b82f6; --base:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
  header{
    position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border);
    padding:.6rem .8rem;display:flex;flex-wrap:wrap;gap:.6rem 1rem;align-items:center
  }
  header .group{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
  label{font-size:.9rem;color:#374151}
  select,input[type="text"],input[type="number"]{
    border:1px solid var(--border);border-radius:.5rem;padding:.35rem .5rem;background:#fff
  }
  input[type="range"]{width:160px}
  button{border:1px solid var(--border);border-radius:.5rem;background:#fff;padding:.45rem .65rem;cursor:pointer}
  button:active{transform:translateY(1px)}

  main{position:relative;display:flex;justify-content:center;align-items:center;height:calc(100vh - 84px);padding:8px}
  canvas{position:absolute;inset:0;margin:auto;touch-action:none}
  #pautaCanvas{
    background:#fff;z-index:1;box-shadow:0 4px 16px rgba(0,0,0,.10);border:1px solid var(--border);border-radius:12px;
    pointer-events:none;
  }
  #drawCanvas{z-index:2;border-radius:12px}
  #ghostCanvas{z-index:3;pointer-events:none;border-radius:12px}
</style>
</head>
<body>
<header>
  <div class="group">
    <button id="redraw" title="Redibujar pauta">üîÑ Pauta</button>
    <button id="clear" title="Limpiar trazos">üóëÔ∏è Limpiar</button>
    <button id="save" title="Guardar PNG">üíæ PNG</button>
  </div>

  <div class="group">
    <label>Letra:</label>
    <select id="ghostSelect">
      <optgroup label="Min√∫sculas">
        <option>a</option><option>b</option><option>c</option><option>d</option><option>e</option><option>f</option>
        <option>g</option><option>h</option><option>i</option><option>j</option><option>k</option><option>l</option>
        <option>m</option><option>n</option><option>√±</option><option>o</option><option>p</option><option>q</option>
        <option>r</option><option>s</option><option>t</option><option>u</option><option>v</option><option>w</option>
        <option>x</option><option>y</option><option>z</option>
      </optgroup>
      <optgroup label="May√∫sculas">
        <option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option>
        <option>G</option><option>H</option><option>I</option><option>J</option><option>K</option><option>L</option>
        <option>M</option><option>N</option><option>√ë</option><option>O</option><option>P</option><option>Q</option>
        <option>R</option><option>S</option><option>T</option><option>U</option><option>V</option><option>W</option>
        <option>X</option><option>Y</option><option>Z</option>
      </optgroup>
      <optgroup label="Opciones">
        <option value="__custom__">Libre (texto)</option>
        <option value="__none__" selected>Ocultar gu√≠a</option>
      </optgroup>
    </select>
    <input id="ghostText" type="text" placeholder="Escribe aqu√≠‚Ä¶" style="display:none;width:10rem" />
    <label>Tama√±o:</label>
    <input id="ghostSize" type="range" min="40" max="300" value="160" />
    <label><input type="checkbox" id="ghostShow" /> Mostrar</label>
  </div>

  <div class="group">
    <label>Grosor l√°piz:</label>
    <input id="penSize" type="range" min="1" max="16" value="4" />
  </div>
</header>

<main>
  <canvas id="pautaCanvas"></canvas>
  <canvas id="drawCanvas"></canvas>
  <canvas id="ghostCanvas"></canvas>
</main>

<script>
(()=>{
  // ===== Utilidades y refs =====
  const DPR = Math.max(1, window.devicePixelRatio||1);
  const mm2px = mm => mm*96/25.4*DPR;            // px reales del dispositivo
  const px2css = px => (px/DPR)+'px';            // tama√±o visual CSS
  const A4 = { w:mm2px(210), h:mm2px(297) };     // A4 a 96dpi, escalado a DPR

  const pauta = document.getElementById('pautaCanvas');
  const draw  = document.getElementById('drawCanvas');
  const ghost = document.getElementById('ghostCanvas');
  const cvs=[pauta,draw,ghost];

  const btnRedraw = document.getElementById('redraw');
  const btnClear  = document.getElementById('clear');
  const btnSave   = document.getElementById('save');

  const ghostSelect = document.getElementById('ghostSelect');
  const ghostText   = document.getElementById('ghostText');
  const ghostSize   = document.getElementById('ghostSize');
  const ghostShow   = document.getElementById('ghostShow');
  const penSize     = document.getElementById('penSize');

  // ===== Tama√±o y disposici√≥n =====
  function resizeA4(){
    cvs.forEach(cv=>{
      cv.width  = A4.w; cv.height = A4.h;
      cv.style.width  = px2css(A4.w);
      cv.style.height = px2css(A4.h);
    });
    drawPauta();
    drawGuide();
  }
  window.addEventListener('resize', resizeA4, {passive:true});

  // ===== Pauta tipo Lamela (s√≥lida) =====
  function drawPauta(){
    const ctx = pauta.getContext('2d');
    ctx.clearRect(0,0,pauta.width,pauta.height);

    // fondo blanco (para exportar)
    ctx.fillStyle = '#fff';
    ctx.fillRect(0,0,pauta.width,pauta.height);

    const step = mm2px(3);                 // 3 mm
    const topPad = 20*DPR;
    let y = topPad;

    while (y < pauta.height - topPad){
      // ascendente
      strokeH(ctx, y, 1*DPR, '#3b82f6'); y += step;
      // techo
      strokeH(ctx, y, 1*DPR, '#3b82f6'); y += step;
      // base (roja, un pel√≠n m√°s gruesa)
      strokeH(ctx, y, 1.5*DPR, '#ef4444'); y += step;
      // descendente + espacio entre grupos
      strokeH(ctx, y, 1*DPR, '#3b82f6'); y += step*1.6;
    }

    // margen vertical opcional (estilo cuaderno)
    const marginX = mm2px(15);
    ctx.beginPath();
    ctx.moveTo(marginX, 0); ctx.lineTo(marginX, pauta.height);
    ctx.lineWidth = 2*DPR; ctx.strokeStyle = '#10b981'; ctx.stroke();
  }
  function strokeH(ctx, y, w, color){
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(pauta.width, y);
    ctx.lineWidth = w; ctx.strokeStyle = color; ctx.stroke();
  }

  // ===== Gu√≠a de letra: s√≥lida (no punteada) =====
  function currentGuideText(){
    const sel = ghostSelect.value;
    if(sel === '__none__' || !ghostShow.checked) return '';
    if(sel === '__custom__'){
      return (ghostText.value || '').trim();
    }
    return sel; // letra del selector
  }
  function drawGuide(){
    const txt = currentGuideText();
    const ctx = ghost.getContext('2d');
    ctx.clearRect(0,0,ghost.width,ghost.height);
    if(!txt) return;

    const fontPx = parseInt(ghostSize.value, 10) * DPR;

    // Tipograf√≠a s√≥lida, clara y legible
    // (puedes cambiar por otra que te guste: "Comic Sans MS", "Cursive", "KG Primary Dots" si la incluyes, etc.)
    ctx.save();
    ctx.font = `normal ${fontPx}px "Comic Sans MS", "Segoe Print", "Bradley Hand", system-ui, sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    // relleno suave y contorno tenue (s√≥lidos)
    ctx.globalAlpha = 0.28;      // relleno clarito
    ctx.fillStyle = '#111827';
    ctx.fillText(txt, ghost.width/2, ghost.height/2);

    ctx.globalAlpha = 0.6;       // contorno suave
    ctx.lineWidth = Math.max(1, Math.round(fontPx * 0.06));
    ctx.strokeStyle = '#6b7280';
    ctx.strokeText(txt, ghost.width/2, ghost.height/2);
    ctx.restore();
  }

  ghostSelect.addEventListener('change', ()=>{
    const isCustom = (ghostSelect.value === '__custom__');
    const isNone   = (ghostSelect.value === '__none__');
    ghostText.style.display = isCustom ? 'inline-block' : 'none';
    // Si eliges "Ocultar gu√≠a", desmarca el toggle de mostrar
    if(isNone){ ghostShow.checked = false; }
    else { ghostShow.checked = true; }
    drawGuide();
  });
  ghostText.addEventListener('input', drawGuide);
  ghostSize.addEventListener('input', drawGuide);
  ghostShow.addEventListener('change', drawGuide);

  // ===== Dibujo libre (l√°piz) =====
  const dctx = draw.getContext('2d');
  dctx.lineCap = 'round'; dctx.lineJoin = 'round';

  let drawing=false;
  function pxy(e){
    // Soporta t√°ctil/rat√≥n con precisi√≥n
    const rect = draw.getBoundingClientRect();
    const x = (e.clientX - rect.left) * DPR;
    const y = (e.clientY - rect.top)  * DPR;
    return {x,y};
  }
  draw.addEventListener('pointerdown', e=>{
    e.preventDefault();
    drawing=true;
    const {x,y}=pxy(e);
    dctx.beginPath();
    dctx.moveTo(x,y);
    dctx.lineWidth = parseFloat(penSize.value) * DPR;
    dctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--ink').trim() || '#111';
  }, {passive:false});
  draw.addEventListener('pointermove', e=>{
    if(!drawing) return;
    const {x,y}=pxy(e);
    dctx.lineTo(x,y);
    dctx.stroke();
  }, {passive:false});
  ['pointerup','pointercancel','pointerleave'].forEach(ev=>{
    draw.addEventListener(ev, ()=>{ drawing=false; }, {passive:false});
  });

  // ===== Botones =====
  btnRedraw.addEventListener('click', drawPauta);
  btnClear.addEventListener('click', ()=>{ dctx.clearRect(0,0,draw.width,draw.height); });
  btnSave.addEventListener('click', ()=>{
    const off = document.createElement('canvas');
    off.width = pauta.width; off.height = pauta.height;
    const o = off.getContext('2d');
    // Composici√≥n final (pauta + gu√≠a + trazos)
    o.drawImage(pauta,0,0);
    o.drawImage(ghost,0,0);
    o.drawImage(draw,0,0);
    const a = document.createElement('a');
    a.href = off.toDataURL('image/png');
    a.download = 'pauta-trazos.png';
    a.click();
  });

  // ===== Init =====
  resizeA4();
  // Estado inicial: gu√≠a oculta
  ghostShow.checked = false;
  drawGuide();
})();
</script>
</body>
</html>