<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Pauta Lamela ‚Äî pr√°ctica de trazos</title>
<style>
  body{margin:0;background:#f3f4f6;font-family:system-ui;min-height:100vh;display:flex;flex-direction:column}
  header{
    flex:0 0 auto;background:#fff;border-bottom:1px solid #ddd;
    padding:.6rem .8rem;display:flex;flex-wrap:wrap;gap:.6rem 1rem;align-items:center;
    overflow-x:auto;position:sticky;top:0;z-index:10;
  }
  header .group{display:flex;flex-wrap:wrap;gap:.4rem;align-items:center}
  main{flex:1 1 auto;display:flex;justify-content:center;align-items:center;
       overflow:hidden;position:relative;background:#ddd;}
  #paperWrapper{transform-origin:0 0;display:inline-block;position:relative;}
  canvas{position:absolute;inset:0;margin:auto;touch-action:none}
  #pautaCanvas{background:#fff;z-index:1;border:1px solid #ccc;pointer-events:none}
  #drawCanvas{z-index:2}
  #ghostCanvas{z-index:3;pointer-events:none}
  #animCanvas{z-index:4;pointer-events:none}
</style>
</head>
<body>
<header>
  <div class="group">
    <button id="zoomIn">‚ûï Zoom</button>
    <button id="zoomOut">‚ûñ Zoom</button>
    <button id="panLeft">‚¨ÖÔ∏è</button>
    <button id="panRight">‚û°Ô∏è</button>
    <button id="panUp">‚¨ÜÔ∏è</button>
    <button id="panDown">‚¨áÔ∏è</button>
    <button id="resetView">üîÑ Reset</button>
  </div>
  <div class="group">
    <label>Gu√≠a:</label>
    <select id="guideMode">
      <option value="letter" selected>Letra √∫nica</option>
      <option value="word">Palabra en l√≠nea</option>
      <option value="none">Ocultar</option>
    </select>
    <input id="guideText" type="text" placeholder="Escribe aqu√≠‚Ä¶" value="hola" style="width:8rem" />
    <input id="guideSize" type="range" min="40" max="200" value="120" />
    <button id="animate">‚ñ∂Ô∏è Animar trazo</button>
  </div>
</header>

<main>
  <div id="paperWrapper">
    <canvas id="pautaCanvas"></canvas>
    <canvas id="drawCanvas"></canvas>
    <canvas id="ghostCanvas"></canvas>
    <canvas id="animCanvas"></canvas>
  </div>
</main>

<script>
(()=>{
  const DPR = window.devicePixelRatio||1;
  const mm2px = mm => mm*96/25.4*DPR;
  const A4 = { w:mm2px(210), h:mm2px(297) };

  const pauta=document.getElementById('pautaCanvas');
  const draw=document.getElementById('drawCanvas');
  const ghost=document.getElementById('ghostCanvas');
  const anim=document.getElementById('animCanvas');
  const wrapper=document.getElementById('paperWrapper');
  const cvs=[pauta,draw,ghost,anim];

  const guideMode=document.getElementById('guideMode');
  const guideText=document.getElementById('guideText');
  const guideSize=document.getElementById('guideSize');

  // Zoom & Pan
  let scale=1, offsetX=0, offsetY=0;
  function applyTransform(){
    wrapper.style.transform=`translate(${offsetX}px,${offsetY}px) scale(${scale})`;
  }
  document.getElementById('zoomIn').onclick=()=>{scale*=1.2;applyTransform();}
  document.getElementById('zoomOut').onclick=()=>{scale/=1.2;applyTransform();}
  document.getElementById('panLeft').onclick=()=>{offsetX-=50;applyTransform();}
  document.getElementById('panRight').onclick=()=>{offsetX+=50;applyTransform();}
  document.getElementById('panUp').onclick=()=>{offsetY-=50;applyTransform();}
  document.getElementById('panDown').onclick=()=>{offsetY+=50;applyTransform();}
  document.getElementById('resetView').onclick=()=>{scale=1;offsetX=0;offsetY=0;applyTransform();}

  // Pauta
  function resizeA4(){
    cvs.forEach(cv=>{cv.width=A4.w;cv.height=A4.h;
      cv.style.width=(A4.w/DPR)+'px';cv.style.height=(A4.h/DPR)+'px';});
    drawPauta(); drawGuide();
  }
  function drawPauta(){
    const ctx=pauta.getContext('2d');
    ctx.fillStyle='#fff';ctx.fillRect(0,0,pauta.width,pauta.height);
    const step=mm2px(3), top=20*DPR;
    pauta.dataset.step=step; pauta.dataset.top=top; pauta.dataset.period=step*4.6;
    let y=top;
    while(y<pauta.height-top){
      ctx.strokeStyle='#3b82f6';ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); y+=step;
      ctx.strokeStyle='#3b82f6';ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); y+=step;
      ctx.strokeStyle='#ef4444';ctx.lineWidth=1.5*DPR;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke();ctx.lineWidth=1; y+=step;
      ctx.strokeStyle='#3b82f6';ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); y+=step*1.6;
    }
    // margen
    const marginX=mm2px(15); pauta.dataset.margin=marginX;
    ctx.strokeStyle='#10b981';ctx.beginPath();ctx.moveTo(marginX,0);ctx.lineTo(marginX,pauta.height);ctx.stroke();
  }

  // Gu√≠a
  function drawGuide(){
    const ctx=ghost.getContext('2d'); ctx.clearRect(0,0,ghost.width,ghost.height);
    const mode=guideMode.value; if(mode==='none') return;
    const txt=guideText.value||''; if(!txt) return;
    const fontPx=parseInt(guideSize.value,10)*DPR;
    const step=parseFloat(pauta.dataset.step), top=parseFloat(pauta.dataset.top);
    const baseY=top+2*step;
    const marginX=parseFloat(pauta.dataset.margin);

    ctx.save();
    ctx.font=`${fontPx}px "Comic Sans MS", cursive, sans-serif`;
    ctx.textBaseline='alphabetic'; ctx.fillStyle='rgba(0,0,0,0.25)';

    if(mode==='letter'){
      ctx.textAlign='left';
      ctx.fillText(txt[0], marginX+10*DPR, baseY);
    }
    if(mode==='word'){
      ctx.textAlign='left';
      let x=marginX+10*DPR;
      for(let i=0;i<txt.length;i++){
        ctx.fillText(txt[i], x, baseY);
        x+=fontPx*0.7; // espacio proporcional
      }
    }
    ctx.restore();
  }

  guideMode.onchange=drawGuide;
  guideText.oninput=drawGuide;
  guideSize.oninput=drawGuide;

  // Animar trazo (flecha)
  document.getElementById('animate').onclick=()=>{
    const ctx=anim.getContext('2d'); ctx.clearRect(0,0,anim.width,anim.height);
    const step=parseFloat(pauta.dataset.step), top=parseFloat(pauta.dataset.top);
    const baseY=top+2*step;
    const marginX=parseFloat(pauta.dataset.margin);
    let startX=marginX+10*DPR, startY=baseY-60*DPR;
    let endX=startX+100*DPR, endY=baseY;
    let progress=0;
    function drawArrow(){
      ctx.clearRect(0,0,anim.width,anim.height);
      ctx.strokeStyle='red'; ctx.lineWidth=3*DPR;
      ctx.beginPath();
      ctx.moveTo(startX,startY);
      ctx.lineTo(startX+(endX-startX)*progress, startY+(endY-startY)*progress);
      ctx.stroke();
      if(progress<1){ progress+=0.02; requestAnimationFrame(drawArrow);}
      else {
        // dibuja la cabeza de flecha
        ctx.beginPath();
        ctx.moveTo(endX,endY);
        ctx.lineTo(endX-15*DPR,endY-10*DPR);
        ctx.lineTo(endX-15*DPR,endY+10*DPR);
        ctx.closePath();
        ctx.fillStyle='red'; ctx.fill();
      }
    }
    drawArrow();
  };

  // Init
  resizeA4(); applyTransform();
})();
</script>
</body>
</html>