<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Pauta Lamela ‚Äî pr√°ctica de trazos</title>
<style>
  body{margin:0;background:#f3f4f6;font-family:sans-serif}
  header{padding:.5rem;background:#fff;border-bottom:1px solid #ddd;display:flex;flex-wrap:wrap;gap:.5rem}
  canvas{position:absolute;inset:0;margin:auto;touch-action:none}
  #pautaCanvas{background:#fff;z-index:1;box-shadow:0 2px 12px rgba(0,0,0,.1);border:1px solid #ccc}
  #drawCanvas{z-index:2}
  #ghostCanvas{z-index:3;pointer-events:none}
  #pautaCanvas{pointer-events:none}
  main{position:relative;display:flex;justify-content:center;align-items:center;height:calc(100vh - 70px)}
</style>
</head>
<body>
<header>
  <button id="redraw">üîÑ Redibujar pauta</button>
  <button id="clear">üóëÔ∏è Limpiar</button>
  <button id="save">üíæ Guardar PNG</button>
</header>
<main>
  <canvas id="pautaCanvas"></canvas>
  <canvas id="drawCanvas"></canvas>
  <canvas id="ghostCanvas"></canvas>
</main>
<script>
(()=>{
  const DPR = window.devicePixelRatio||1;
  const mm2px = mm => mm*96/25.4*DPR;

  const pautaCv=document.getElementById('pautaCanvas');
  const drawCv=document.getElementById('drawCanvas');
  const ghostCv=document.getElementById('ghostCanvas');
  const cvs=[pautaCv,drawCv,ghostCv];

  function resizeA4(){
    const w=mm2px(210), h=mm2px(297); // A4
    cvs.forEach(cv=>{
      cv.width=w; cv.height=h;
      cv.style.width=w/DPR+"px"; cv.style.height=h/DPR+"px";
    });
    drawPauta();
  }

  function drawPauta(){
    const ctx=pautaCv.getContext('2d');
    ctx.clearRect(0,0,pautaCv.width,pautaCv.height);
    ctx.fillStyle="#fff";ctx.fillRect(0,0,pautaCv.width,pautaCv.height);
    const step=mm2px(3); // 3 mm
    let y=20;
    ctx.lineWidth=1*DPR;
    while(y<pautaCv.height-20){
      ctx.strokeStyle="#3b82f6"; line(y); y+=step;   // ascendente
      ctx.strokeStyle="#3b82f6"; line(y); y+=step;   // techo
      ctx.strokeStyle="#ef4444"; ctx.lineWidth=1.5*DPR; line(y); y+=step; // base
      ctx.strokeStyle="#3b82f6"; ctx.lineWidth=1*DPR; line(y); y+=step*1.6; // descendente + espacio
    }
    function line(ypos){ctx.beginPath();ctx.moveTo(0,ypos);ctx.lineTo(pautaCv.width,ypos);ctx.stroke();}
    console.log("‚úÖ Pauta dibujada");
  }

  // Dibujo libre
  const ctx=drawCv.getContext('2d'); ctx.lineCap="round"; ctx.lineJoin="round";
  let drawing=false, last=null;
  drawCv.addEventListener("pointerdown",e=>{
    drawing=true;ctx.beginPath();
    ctx.moveTo(e.offsetX*DPR,e.offsetY*DPR);
  });
  drawCv.addEventListener("pointermove",e=>{
    if(!drawing)return;
    ctx.lineWidth=3*DPR; ctx.strokeStyle="#111";
    ctx.lineTo(e.offsetX*DPR,e.offsetY*DPR); ctx.stroke();
  });
  ["pointerup","pointerleave"].forEach(ev=>drawCv.addEventListener(ev,()=>drawing=false));

  // Botones
  document.getElementById("redraw").onclick=drawPauta;
  document.getElementById("clear").onclick=()=>ctx.clearRect(0,0,drawCv.width,drawCv.height);
  document.getElementById("save").onclick=()=>{
    const off=document.createElement("canvas");
    off.width=pautaCv.width;off.height=pautaCv.height;
    const octx=off.getContext("2d");
    octx.drawImage(pautaCv,0,0);
    octx.drawImage(drawCv,0,0);
    const a=document.createElement("a");
    a.href=off.toDataURL();a.download="pauta.png";a.click();
  };

  resizeA4();
  window.addEventListener("resize",resizeA4);
})();
</script>
</body>
</html>