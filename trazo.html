<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Pauta Lamela ‚Äî pr√°ctica de trazos</title>
<style>
  :root{
    --ink:#111; --border:#d1d5db; --bg:#f3f4f6;
    --sec:#3b82f6; --base:#ef4444; --margin:#10b981;
  }
  body{margin:0;background:var(--bg);font-family:system-ui;min-height:100vh;display:flex;flex-direction:column}
  header{
    flex:0 0 auto;background:#fff;border-bottom:1px solid var(--border);
    padding:.6rem .8rem;display:flex;flex-wrap:wrap;gap:.6rem 1rem;align-items:center;
    overflow-x:auto;position:sticky;top:0;z-index:10;
  }
  header .group{display:flex;flex-wrap:wrap;gap:.4rem;align-items:center}
  main{
    flex:1 1 auto;display:flex;justify-content:center;align-items:center;
    overflow:hidden;position:relative;background:#ddd;
  }
  #paperWrapper{
    transform-origin:0 0;
    display:inline-block;position:relative;
  }
  canvas{position:absolute;inset:0;margin:auto;touch-action:none}
  #pautaCanvas{background:#fff;z-index:1;border:1px solid var(--border);pointer-events:none}
  #drawCanvas{z-index:2}
  #ghostCanvas{z-index:3;pointer-events:none}
</style>
</head>
<body>
<header>
  <div class="group">
    <button id="zoomIn">‚ûï Zoom</button>
    <button id="zoomOut">‚ûñ Zoom</button>
    <button id="panLeft">‚¨ÖÔ∏è</button>
    <button id="panRight">‚û°Ô∏è</button>
    <button id="panUp">‚¨ÜÔ∏è</button>
    <button id="panDown">‚¨áÔ∏è</button>
    <button id="resetView">üîÑ Reset</button>
  </div>

  <div class="group">
    <label>Letra:</label>
    <select id="ghostSelect">
      <option>a</option><option>b</option><option>c</option><option>d</option>
      <option>e</option><option>f</option><option>g</option><option>h</option>
      <option>i</option><option>j</option><option>k</option><option>l</option>
      <option>m</option><option>n</option><option>√±</option><option>o</option>
      <option>p</option><option>q</option><option>r</option><option>s</option>
      <option>t</option><option>u</option><option>v</option><option>w</option>
      <option>x</option><option>y</option><option>z</option>
      <option>A</option><option>B</option><option>C</option>
      <option>Z</option>
      <option value="__none__">Ocultar</option>
    </select>
    <input id="ghostSize" type="range" min="40" max="300" value="160" />
  </div>
</header>

<main>
  <div id="paperWrapper">
    <canvas id="pautaCanvas"></canvas>
    <canvas id="drawCanvas"></canvas>
    <canvas id="ghostCanvas"></canvas>
  </div>
</main>

<script>
(()=>{
  const DPR = window.devicePixelRatio||1;
  const mm2px = mm => mm*96/25.4*DPR;
  const A4 = { w:mm2px(210), h:mm2px(297) };

  const pauta=document.getElementById('pautaCanvas');
  const draw=document.getElementById('drawCanvas');
  const ghost=document.getElementById('ghostCanvas');
  const wrapper=document.getElementById('paperWrapper');
  const cvs=[pauta,draw,ghost];

  const ghostSelect=document.getElementById('ghostSelect');
  const ghostSize=document.getElementById('ghostSize');

  // ====== Zoom & Pan ======
  let scale=1, offsetX=0, offsetY=0;
  function applyTransform(){
    wrapper.style.transform=`translate(${offsetX}px,${offsetY}px) scale(${scale})`;
  }
  document.getElementById('zoomIn').onclick=()=>{scale*=1.2;applyTransform();}
  document.getElementById('zoomOut').onclick=()=>{scale/=1.2;applyTransform();}
  document.getElementById('panLeft').onclick=()=>{offsetX-=50;applyTransform();}
  document.getElementById('panRight').onclick=()=>{offsetX+=50;applyTransform();}
  document.getElementById('panUp').onclick=()=>{offsetY-=50;applyTransform();}
  document.getElementById('panDown').onclick=()=>{offsetY+=50;applyTransform();}
  document.getElementById('resetView').onclick=()=>{scale=1;offsetX=0;offsetY=0;applyTransform();}

  // ====== Pauta ======
  function resizeA4(){
    cvs.forEach(cv=>{cv.width=A4.w;cv.height=A4.h;cv.style.width=(A4.w/DPR)+'px';cv.style.height=(A4.h/DPR)+'px';});
    drawPauta(); drawGuide();
  }
  function drawPauta(){
    const ctx=pauta.getContext('2d');
    ctx.fillStyle='#fff';ctx.fillRect(0,0,pauta.width,pauta.height);
    const step=mm2px(3), top=20*DPR;
    let y=top;
    pauta.dataset.step=step; pauta.dataset.top=top; pauta.dataset.period=step*4.6;
    while(y<pauta.height-top){
      ctx.strokeStyle='#3b82f6'; ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); y+=step;
      ctx.strokeStyle='#3b82f6'; ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); y+=step;
      ctx.strokeStyle='#ef4444'; ctx.lineWidth=1.5*DPR;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); ctx.lineWidth=1; y+=step;
      ctx.strokeStyle='#3b82f6'; ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(pauta.width,y);ctx.stroke(); y+=step*1.6;
    }
    // margen
    const marginX=mm2px(15);
    pauta.dataset.margin=marginX;
    ctx.strokeStyle='#10b981';ctx.beginPath();ctx.moveTo(marginX,0);ctx.lineTo(marginX,pauta.height);ctx.stroke();
  }

  // ====== Gu√≠a ======
  function drawGuide(){
    const ctx=ghost.getContext('2d'); ctx.clearRect(0,0,ghost.width,ghost.height);
    const txt=ghostSelect.value; if(txt==='__none__') return;
    const fontPx=parseInt(ghostSize.value,10)*DPR;
    const step=parseFloat(pauta.dataset.step), top=parseFloat(pauta.dataset.top);
    const baseY=top+2*step; // primera l√≠nea roja
    const marginX=parseFloat(pauta.dataset.margin);

    ctx.save();
    ctx.font=`${fontPx}px "Comic Sans MS", cursive, sans-serif`;
    ctx.textAlign='left'; ctx.textBaseline='alphabetic';
    ctx.fillStyle='rgba(0,0,0,0.25)';
    ctx.fillText(txt, marginX+10*DPR, baseY); // pegado al margen + 10px aire
    ctx.restore();
  }

  // ====== Dibujo libre (simplificado) ======
  const dctx=draw.getContext('2d'); dctx.lineCap='round';dctx.lineJoin='round';
  let drawing=false;
  draw.addEventListener('pointerdown',e=>{drawing=true;dctx.beginPath();dctx.moveTo((e.offsetX)*DPR,(e.offsetY)*DPR);});
  draw.addEventListener('pointermove',e=>{if(drawing){dctx.lineWidth=3*DPR;dctx.strokeStyle='#111';dctx.lineTo(e.offsetX*DPR,e.offsetY*DPR);dctx.stroke();}});
  ['pointerup','pointerleave'].forEach(ev=>draw.addEventListener(ev,()=>drawing=false));

  ghostSelect.onchange=drawGuide;
  ghostSize.oninput=drawGuide;

  resizeA4();
  applyTransform();
})();
</script>
</body>
</html>